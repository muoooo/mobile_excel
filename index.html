<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form to Excel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/file-saver/dist/FileSaver.min.js"></script>
</head>

<body class="bg-light p-3">
  <div class="container">
    <div class="row">
      <div class="col-12 d-flex mb-2">
        <button class="ms-auto btn btn-success" onclick="exportExcel()">Export to Excel</button>
        <button class="ms-1 btn btn-dark" id="openModalBtn">+ Add Entry</button>
      </div>

      <div class="col-12">
      </div>

      <div class="col-12" id="entryList"></div>
    </div>
  </div>

  <dialog id="myModal" style="border: 1px solid #ccc; border-radius: 6px; padding:20px;">
    <form method="dialog" id="entryForm">
      <h4 class="mb-3">New Entry</h4>

      <div class="mb-2 d-flex justify-content-between">
        <label>Date</label>
        <input type="date" class="form-control w-50" id="f_date" />
      </div>

      <div class="mb-2 d-flex justify-content-between">
        <label>From</label>
        <input type="text" class="form-control w-50" id="f_from" />
      </div>

      <div class="mb-2 d-flex justify-content-between">
        <label>Amount</label>
        <input type="number" class="form-control w-50" id="f_amount" />
      </div>

      <div class="mb-2 d-flex justify-content-between">
        <label>Location</label>
        <input type="text" class="form-control w-50" id="f_location" />
      </div>

      <div class="mb-2 d-flex justify-content-between">
        <label>Location in site</label>
        <input type="text" class="form-control w-50" id="f_location_in" />
      </div>

      <div class="mb-2 d-flex justify-content-between">
        <label>Kamaz No.</label>
        <input type="text" class="form-control w-50" id="f_kamaz" />
      </div>

      <div class="d-flex gap-2 mt-3">
        <button class="btn btn-light w-50" id="closeModalBtn">Close</button>
        <button class="btn btn-dark w-50" type="button" onclick="addEntry()">Add</button>
      </div>
    </form>
  </dialog>

  <script>
    const openModalBtn = document.getElementById('openModalBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const myModal = document.getElementById('myModal');

    let entries = [];

    openModalBtn.onclick = () => myModal.showModal();
    closeModalBtn.onclick = () => myModal.close();

    myModal.addEventListener('click', e => { if (e.target === myModal) myModal.close() });

    function addEntry() {
      const e = {
        date: document.getElementById('f_date').value,
        from: document.getElementById('f_from').value,
        amount: document.getElementById('f_amount').value,
        location: document.getElementById('f_location').value,
        location_in: document.getElementById('f_location_in').value,
        kamaz: document.getElementById('f_kamaz').value
      };

      entries.push(e);
      renderEntries();
      myModal.close();
    }

    function renderEntries() {
      const container = document.getElementById('entryList');
      container.innerHTML = '';

      entries.forEach((e, i) => {
        const card = document.createElement('div');
        card.className = 'card mb-2';
        card.innerHTML = `
          <div class="card-body">
            <strong>${e.date}</strong> â€” <strong>${e.from}</strong>
            <ul class="mt-2 p-0" style="list-style:none;">
              <li class="d-flex justify-content-between"><b>Amount:</b> ${e.amount}</li>
              <li class="d-flex justify-content-between"><b>Location:</b> ${e.location}</li>
              <li class="d-flex justify-content-between"><b>Location in site:</b> ${e.location_in}</li>
              <li class="d-flex justify-content-between"><b>Kamaz No.:</b> ${e.kamaz}</li>
            </ul>
            <button class="btn btn-danger btn-sm" onclick="deleteEntry(${i})">Delete</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function deleteEntry(i) {
      entries.splice(i, 1);
      renderEntries();
    }

    function exportExcel() {
      const header = ["Date", "From", "Amount", "Location", "Location in Site", "Kamaz No."];
      const data = [header, ...entries.map(e => [e.date, e.from, e.amount, e.location, e.location_in, e.kamaz])];

      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Sheet1");

      const out = XLSX.write(wb, { bookType: "xlsx", type: "array" });
      saveAs(new Blob([out], { type: "application/octet-stream" }), "entries.xlsx");
    }
  </script>
</body>

</html>
